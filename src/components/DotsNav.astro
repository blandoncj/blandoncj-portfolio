---
const sections = [
  { id: "about", label: "About" },
  { id: "skills", label: "Skills" },
  { id: "experience", label: "Experience" },
  { id: "projects", label: "Projects" },
  { id: "education", label: "Education" },
];
---

<nav
  class="fixed right-8 top-1/2 -translate-y-1/2 z-50 hidden md:flex flex-col gap-4"
>
  {
    sections.map((section) => (
      <a
        href={`#${section.id}`}
        class="group relative w-3 h-3 rounded-full border-2 border-gray-400 hover:border-white transition-all duration-300"
        data-section={section.id}
        aria-label={`Go to ${section.label}`}
      >
        <span class="absolute right-6 top-1/2 -translate-y-1/2 text-sm text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity duration-300 whitespace-nowrap">
          {section.label}
        </span>
      </a>
    ))
  }
</nav>

<style>
  nav a.active {
    background-color: white;
    border-color: white;
  }

  nav a.active::after {
    content: "";
    position: absolute;
    inset: -4px;
    border-radius: 9999px;
  }
</style>

<script>
  const observer = new IntersectionObserver(
    (entries) => {
      const intersecting = Array.from(entries).filter((e) => e.isIntersecting);
      if (intersecting.length === 0) return;

      intersecting.sort((a, b) => b.intersectionRatio - a.intersectionRatio);
      const top = intersecting[0];
      const id = top.target.id;

      document.querySelectorAll("nav a").forEach((link) => {
        link.classList.remove("active");
        if (link.getAttribute("data-section") === id) {
          link.classList.add("active");
        }
      });
    },
    { threshold: [0, 0.25, 0.5, 0.75, 1] },
  );

  document
    .querySelectorAll("section[id]")
    .forEach((section) => observer.observe(section));

  document.querySelectorAll('nav a[href^="#"]').forEach((anchor) => {
    anchor.addEventListener("click", (e) => {
      e.preventDefault();
      const href = anchor.getAttribute("href");
      const target = href ? document.querySelector(href) : null;
      if (target) {
        target.scrollIntoView({ behavior: "smooth", block: "start" });
      }
    });
  });
</script>
